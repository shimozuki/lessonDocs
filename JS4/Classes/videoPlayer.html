<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
		<style>
.videoContainer {
	width: 100%;
	position: fixed;
	top: 0px;
	left: 0px;
	background: rgba(20, 40, 50, 1);
	text-align: center;
}
.vPlayer {
	height: 400px;
}
.videoCaption {
	position: absolute;
	top: 10px;
	background: rgba(20, 40, 50, 0.3);
	font-size: 30px;
	color: rgba(255, 255, 255, 1);
	padding: 5px;
	width: 100%;
}
.inputContainer {
	width: 600px;
	margin: 430px auto 20 auto;
}
.captionInput {
	width: 300px;
}
.caption {
	display: flex;
	justify-content: space-between;
}
.caption h5 {
	width: 100%;
}
.control {
	width: 100px;
}
		</style>

    <title>videoPlayer.html</title>
  </head>
  <body>

		<div class="videoContainer">
			<video class="vPlayer" src="https://r4---sn-o097znl6.googlevideo.com/videoplayback?expire=1579650758&ei=ZjonXsSzM4jfgwPb3aOwAQ&ip=104.144.126.105&id=o-AGfL8s9BO_-Qr9UEkxapXc0-YVJiuii8G6C80nNakPr3&itag=18&source=youtube&requiressl=yes&pcm2=no&vprv=1&mime=video%2Fmp4&gir=yes&clen=10002468&ratebypass=yes&dur=149.931&lmt=1575169236127037&fvip=4&fexp=23842630%2C23860863&c=WEB&txp=5531432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cpcm2%2Cvprv%2Cmime%2Cgir%2Cclen%2Cratebypass%2Cdur%2Clmt&sig=ALgxI2wwRgIhAIZ7M-CmEkdUaZFN0MSuU3U5lX17Wvud4kYG7m3SwbbSAiEAnAfzMXDc_jS1seVG1xOpkqe433hlwd9A_pbE_5Nbx-M%3D&type=video%25252Fmp4%25253B%252Bcodecs%25253D%252522avc1.42001E%25252C%252Bmp4a.40.2%252522&quality=medium&title=The%2BLast%2BOf%2BUs%2BFingerstyle%2BGuitar%2BMain%2BTheme&cms_redirect=yes&mip=130.65.254.9&mm=31&mn=sn-o097znl6&ms=au&mt=1579629148&mv=m&mvi=3&pl=16&lsparams=mip,mm,mn,ms,mv,mvi,pl&lsig=AHylml4wRQIhALVxJ2HdE-WMmOZJJ8TpTrwO_M8GhQAvhX9pZC3w1aoTAiA7nTqWHqg7SytvKCwcOeHhVqRsYZxhzH-G5E7aY3uY5g==" controls=""></video>
			<div class="videoCaption"></div>
		</div> 

		<div class="inputContainer">
			<h3>Add Caption</h3>
			<input class="captionInput" type="text" placeholder="Caption">
			<input class="startInput" type="text" placeholder="Start (ms)">
			<input class="endInput" type="text" placeholder="End (ms)">
			<button class="submit">Save</button>
			<hr>

			<div class="captionList"></div>
		</div>

		<script>
const videoElement = document.querySelector('.vPlayer')
const videoCaption = document.querySelector('.videoCaption')
const caption = document.querySelector('.caption')

videoElement.addEventListener('timeupdate', (e) => {
	const curMS = videoElement.currentTime * 1000
	const captionsAfterCurrent = captions.filter((e) => {
		return e.start <= curMS
	})
	const validCaptions = captionsAfterCurrent.filter((e) => {
		return e.end > curMS
	})
	let captionText = ''
	if (validCaptions.length) {
		captionText = validCaptions[0].txt
	}
	videoCaption.innerText = captionText
})

let captions = [{
	txt: "Doggo chilling in the back",
	start: 0,
	end: 2000
},{
	txt: "Guitar starts playing",
	start: 2000,
	end: 5000
}, {
	txt: "Last of us theme",
	start: 5000,
	end: 10000
}, {
	txt: "Doggo seems so tired of hearing this song",
	start: 10000, 
	end: 50000
}]

const captionList = document.querySelector('.captionList')

function Caption(data, idx) {
	const div = document.createElement('div')
	div.classList.add('caption')
	div.innerHTML = `
	<h5>${data.txt}</h5>
	<p class="control startAt">${data.start}</p>
	<p class="control endAt">${data.end}</p>
	`
	div.addEventListener('click', () => {
		if (confirm(`Remove caption: ${data.txt}?`)) {
			captions.splice(idx, 1)
			div.remove()
		}
	})
	captionList.append(div)
}

captions.forEach((e, i) => {
	new Caption(e, i)
})

const submitButton = document.querySelector('.submit')
const captionInput = document.querySelector('.captionInput')
const startInput = document.querySelector('.startInput')
const endInput = document.querySelector('.endInput')

submitButton.addEventListener('click', () => {
	const captionTxt = captionInput.value
	if (captionTxt.length < 3) {
		return
	}
	const startTime = +startInput.value
	const endTime = +endInput.value

	if (!Number.isInteger(startTime) || !Number.isInteger(endTime)) {
		return
	}

	const data = {
		txt: captionTxt,
		start: startTime, 
		end: endTime
	}
	captions.push(data)
	new Caption(data, captions.length-1)
})
		</script>
  </body>
</html>
